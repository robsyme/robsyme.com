#+BEGIN_HTML
---
title: Blogging from your text editor with orgmode and middleman
tags: emacs lisp ruby orgmode middleman
description: How to write blog posts in emacs orgmode for a ruby static site generator.
---
#+END_HTML

* Introduction
  
  Before setting up this blog, I used emacs but had never really
  written any lisp. This post details some serious [[http://blog.hasmanythrough.com/2012/1/4/yak-shaving][yak shaving]], but it
  did give me a good excuse to write some lisp and some shitty web
  design.
  
  I'm not suggesting that this is the most efficient way to publish
  words and pictures on the internet. This is simply a description of
  how I'm doing it at the moment.
  
* Components
  
  [[file:resources/workflow_overview.png]]
  
  Posts are coposed in Emacs.
  
  A keystroke [[http://orgmode.org/guide/Publishing.html#Publishing][publishes]] the post to a directory that sits within a
  [[http://middlemanapp.com/][Middleman]] application. Publishing to the web is simply 'git commit'
  and 'git push heroku'. [[https://www.heroku.com/][Heroku]] builds the static site and hosts it
  (for free) on the web.

* Trying this at home
  
  You can view the code for both [[http://github.com/robsyme/robsyme.com][the site]] and my [[http://github.com/robsyme/emacs.d/][emacs configuration]]
  if you are really keen, but I'll sketch the outline here so you can
  build something similar if you feel inspired.

** Publishing

   You need to set the variable 'org-publish-project-alist' with
   something like:

   #+BEGIN_SRC elisp :eval never :comments org
     (setq org-publish-project-alist
           '(( "blog"
               :base-directory "~/site/org/blog/"               ;;(ref:base-directory)
               :base-extension "org"                            ;;(ref:base-extension)
               :publishing-directory "~/site/source/blog/" ;;(ref:publishing-directory)
               :recursive t
               :body-only t
               :html-extension "html.erb"
               :publish-function org-publish-org-to-html)     ;;(ref:publish-function)
             ( "blog-static"
               :base-directory "~/site/org/blog/"
               :base-extension "png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|webm\\|mp4\\|ogv"
               :publishing-directory "~/site/source/blog/"
               :recursive t
               :publish-function org-publish-attachment)
             ("whole" :components ("blog" "blog-static"))))
   #+END_SRC

   Testing [[(base-directory)][link highlight]].
   
   
* COMMENT Good things
  
  Things I like about doing it this way.
  
** Emacs
   - It's free.
   - I like being able to run code and capture both the input and the
     output for publishing.
   - I write my lab notebook the same way, published on a non-public
     server.
   - Writing code for publication happens in the same way that I would
     write it if it wasn't being published. Reducing this friction
     makes keeping good notes much more lilkely.
   - Links, syntax highlighting, document structure, keywords and even
     [[file:~/site/org/blog/2013/04/20/Emacs-for-computational-Biology---Part-1/index.org][code evaluation]] are taken care of by org mode.
   - Everything is in plain text, so it can be easily checked into
     version control.
** Middleman
   - It's free.
   - You get the benefits of a static site (particularly when you put
     something like Cloudflare in front), but you can also bolt on
     other rack objects if you need more dynamic bits.
   - The kind robots at Heroku build it for me.
   - The addition of "activate :livereload" to the configuration
     hooks into the [[http://livereload.com/][LiveReload]] browser extensions to refresh the page
     whenever you make a change (in development).
   - Configurable with a bit of ruby. There is a middleman-blog gem,
     but I only needed a subset of the features (tags), so I just
     [[http://github.com/robsyme/robsyme.com/blob/master/orgblog.rb][wrote my own]].
   - Do your own design. I think web design is an excellent 21st
     century hobby, so I built this by hand on top of the [[http://foundation.zurb.com/][Foundation]]
     framework.
** Heroku
   - It's free (for small projects like this).
   - Heroku builds the site, so all I have to do is 'git push', which
     is what I would do anyway.
   - You can manage drafts by creating and merging branches.
     
* COMMENT Bad things

  Things that aren't all rainbows and unicorns.
  
** Overview
   - You will probably need to write some ruby.
   - You will probably need to write some emacs lisp.
  

